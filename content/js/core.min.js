var Core={createContextMenu:function(){chrome.contextMenus.create({title:chrome.i18n.getMessage("translate")+" '%s'",contexts:["selection"],onclick:Core.translate})},openUrl:function(e,t){chrome.tabs.create({url:e,selected:t})},getSelectedValue:function(e){return e.children[e.selectedIndex].value},getSelectedTextContent:function(e){return e.children[e.selectedIndex].textContent},setSelectedValue:function(e,t){for(var n=0;n<e.children.length;n++){var r=e.children[n];if(r.value===t){r.selected=true;break}}},populateSelect:function(e,t){for(var n in t){var r=document.createElement("option");r.value=n;r.textContent=t[n];e.appendChild(r)}return e},changeElementsVisibility:function(){var e=document.getElementsByTagName("select");var t=document.getElementsByTagName("label");for(var n=0;n<e.length;n++){e[n].className="visible"}for(var r=0;r<t.length;r++){t[r].className="visible"}},translate:function(e){var t=e.selectionText;var n=Core.settings.getViewMode();var r=t.toLowerCase()!==chrome.i18n.getMessage("name").toLowerCase()?"auto":"la";if(n!=="tt"){var i="http://translate.google.com/#"+r+"|"+Core.settings.getTranslateToLanguage()+"|"+encodeURIComponent(t);Core.openUrl(i,n==="ognt"?true:false)}trackTranslate()},localStorage:{saveTranslateToLanguage:function(e){Core.localStorage.save("tl",e)},saveViewMode:function(e){Core.localStorage.save("vm",e)},save:function(e,t){localStorage.setItem(e,t)},getValue:function(e){return localStorage.getItem(e)},exists:function(e){return localStorage[e]?true:false}},settings:{open:function(){var e=false;if(!Core.localStorage.exists("ft")){Core.localStorage.save("ft",e);e=true}if(e){Core.openUrl("./content/settings.html",true)}},save:function(){Core.localStorage.saveTranslateToLanguage(Core.getSelectedValue(document.querySelector("#languages")));Core.localStorage.saveViewMode(Core.getSelectedValue(document.querySelector("#view-mode")));var e=document.querySelector("#message");e.innerHTML=chrome.i18n.getMessage("automatic_save");setTimeout(function(){e.innerHTML=""},1200)},getTranslateToLanguage:function(){return Core.localStorage.exists("tl")?Core.localStorage.getValue("tl"):Core.settings.normalizeLanguageCode(window.navigator.language)},getViewMode:function(){return Core.localStorage.exists("vm")?Core.localStorage.getValue("vm"):"ont"},supportedLocale:function(e){var t=["ar","bg","ca","cs","da","de","el","en","en-GB","en-US","es","es-419","et","fi","fil","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nl","no","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tl","tr","uk","vi","zh-CN","zh-TW"];return t.indexOf(e)!==-1},normalizeLanguageCode:function(e){if(e.toLowerCase()==="zh-tw"){return"zh-TW"}if(e.toLowerCase()==="zh-cn"){return"zh-CN"}if(e.length>=2&&Core.settings.supportedLocale(e)){return e.substr(0,2)}else{return"en"}},loadSupportedLanguages:function(){var e=document.createElement("script");e.src="https://translate.google.com/translate_a/l?client=es&cb=Core.settings.supportedLanguagesCallback&hl="+Core.settings.normalizeLanguageCode(window.navigator.language);document.querySelector("head").appendChild(e)},supportedLanguagesCallback:function(e){var t=document.querySelector("#languages");if("tl"in e){t.innerHTML="";Core.populateSelect(t,e["tl"]);Core.setSelectedValue(t,Core.settings.getTranslateToLanguage())}},loadSupportedViewModes:function(){var e=document.querySelector("#view-mode");var t={ont:chrome.i18n.getMessage("view_mode_ont"),ognt:chrome.i18n.getMessage("view_mode_ognt")};Core.populateSelect(e,t);Core.setSelectedValue(e,Core.settings.getViewMode())}},init:function(){document.addEventListener("DOMContentLoaded",function(){Core.settings.loadSupportedLanguages();Core.settings.loadSupportedViewModes();var e=chrome.i18n.getMessage("name")+" - "+chrome.i18n.getMessage("settings");document.title=e;document.querySelector("#title").innerHTML=e;document.querySelector("#lb_translate_to").innerHTML=chrome.i18n.getMessage("translate_to");document.querySelector("#lb_view-mode").innerHTML=chrome.i18n.getMessage("view_mode");document.querySelector("#languages").addEventListener("change",function(){Core.settings.save();trackLanguage()});document.querySelector("#view-mode").addEventListener("change",function(){Core.settings.save();trackViewMode()});document.onreadystatechange=function(){if(document.readyState==="complete"){Core.changeElementsVisibility()}}})}};Core.init()