var Core={createContextMenu:function(){chrome.contextMenus.create({title:chrome.i18n.getMessage("translate")+" '%s'",contexts:["selection"],onclick:Core.translate})},openUrl:function(a,b){chrome.tabs.create({url:a,selected:b})},getSelectedValue:function(a){return a.children[a.selectedIndex].value},getSelectedTextContent:function(a){return a.children[a.selectedIndex].textContent},setSelectedValue:function(a,b){for(var c=0;c<a.children.length;c++){var d=a.children[c];if(d.value==b){d.selected=true;break}}},populateSelect:function(a,b){for(var c in b){var d=document.createElement("option");d.value=c;d.textContent=b[c];a.appendChild(d)}return a},changeElementsVisibility:function(){var a=document.getElementsByTagName("select");var b=document.getElementsByTagName("label");for(var c=0;c<a.length;c++){a[c].className="visible"}for(var c=0;c<b.length;c++){b[c].className="visible"}},translate:function(a){var b=Core.settings.getViewMode();var c=a.selectionText.toLowerCase()!=chrome.i18n.getMessage("name").toLowerCase()?"auto":"la";if(b!="tt"){var d="http://translate.google.com/#"+c+"|"+Core.settings.getTranslateToLanguage()+"|"+encodeURI(a.selectionText);Core.openUrl(d,b=="ognt"?true:false)}trackTranslate()},localStorage:{saveTranslateToLanguage:function(a){Core.localStorage.save("tl",a)},saveViewMode:function(a){Core.localStorage.save("vm",a)},save:function(a,b){localStorage.setItem(a,b)},getValue:function(a){return localStorage.getItem(a)},exists:function(a){return localStorage[a]?true:false}},settings:{open:function(){var a=false;if(!Core.localStorage.exists("ft")){Core.localStorage.save("ft",a);a=true}if(a)Core.openUrl("./content/settings.html",true)},save:function(){Core.localStorage.saveTranslateToLanguage(Core.getSelectedValue(document.querySelector("#languages")));Core.localStorage.saveViewMode(Core.getSelectedValue(document.querySelector("#view-mode")));var a=document.querySelector("#message");a.innerHTML=chrome.i18n.getMessage("automatic_save");setTimeout(function(){a.innerHTML=""},1200)},getTranslateToLanguage:function(){return Core.localStorage.exists("tl")?Core.localStorage.getValue("tl"):Core.settings.normalizeLanguageCode(window.navigator.language)},getViewMode:function(){return Core.localStorage.exists("vm")?Core.localStorage.getValue("vm"):"ognt"},supportedLocale:function(a){var b=["ar","bg","ca","cs","da","de","el","en","en-GB","en-US","es","es-419","et","fi","fil","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nl","no","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tl","tr","uk","vi","zh-CN","zh-TW"];return b.indexOf(a)!=-1},normalizeLanguageCode:function(a){if(a.toLowerCase()=="zh-tw")return"zh-TW";if(a.toLowerCase()=="zh-cn")return"zh-CN";if(a.length>=2&&Core.settings.supportedLocale(a))return a.substr(0,2);else return"en"},loadSupportedLanguages:function(){var a=document.createElement("script");a.src="http://translate.google.com/translate_a/l?client=es"+"&cb=Core.settings.supportedLanguagesCallback&hl="+Core.settings.normalizeLanguageCode(window.navigator.language);document.querySelector("head").appendChild(a)},supportedLanguagesCallback:function(a){var b=document.querySelector("#languages");if("tl"in a){b.innerHTML="";Core.populateSelect(b,a["tl"]);Core.setSelectedValue(b,Core.settings.getTranslateToLanguage())}},loadSupportedViewModes:function(){var a=document.querySelector("#view-mode");var b={ont:chrome.i18n.getMessage("view_mode_ont"),ognt:chrome.i18n.getMessage("view_mode_ognt")};Core.populateSelect(a,b);Core.setSelectedValue(a,Core.settings.getViewMode())}},init:function(){document.addEventListener("DOMContentLoaded",function(){Core.settings.loadSupportedLanguages();Core.settings.loadSupportedViewModes();var a=chrome.i18n.getMessage("name")+" - "+chrome.i18n.getMessage("settings");document.title=a;document.querySelector("#title").innerHTML=a;document.querySelector("#lb_translate_to").innerHTML=chrome.i18n.getMessage("translate_to");document.querySelector("#lb_view-mode").innerHTML=chrome.i18n.getMessage("view_mode");document.querySelector("#languages").addEventListener("change",function(){Core.settings.save();trackLanguage()});document.querySelector("#view-mode").addEventListener("change",function(){Core.settings.save();trackViewMode()});document.onreadystatechange=function(){if(document.readyState=="complete"){Core.changeElementsVisibility()}}})}};Core.init()